"use strict";angular.module("MainController",[]),angular.module("MainDirective",[]),angular.module("jwwebApp",["ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch","MainController","MainDirective"]).run(["$rootScope","$location","$http","$window","AuthFactory","PostsFactory","CategoryFactory",function(a,b,c,d,e,f,g){a.$on("$routeChangeStart",function(){e.isAuthenticated()&&(c.defaults.headers.common.Authorization="Token token="+d.sessionStorage.getItem("jw-token")),$("nav.navbar").removeClass("active"),$("a#menu-icon").removeClass("active"),f.fetch(),g.fetch()})}]),angular.module("jwwebApp").config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/home.html",controller:"HomeController"}).when("/posts/:postId",{templateUrl:"views/post.html",controller:"PostViewController"}).when("/about",{templateUrl:"views/about.html",controller:"AboutController"}).when("/login",{templateUrl:"views/login.html",controller:"LoginController"}).when("/new-post",{templateUrl:"views/newPost.html",controller:"NewPostController"}).when("/image-uploader",{templateUrl:"views/image-uploader.html",controller:"ImageUploader"}).otherwise({redirectTo:"/"})}]),angular.module("jwwebApp").constant("_",window._).constant("ServerUrl","http://localhost:3000/").constant("AmazonBucket","https://dubya-blog-bucket.s3.amazonaws.com/"),angular.module("MainDirective").directive("jwNavbar",["trace",function(a){return{restrict:"EA",link:function(b,c){$(c).on("click","a#menu-icon",function(b){$(this).toggleClass("active"),$("nav.navbar").toggleClass("active"),a(b)})}}}]),angular.module("MainDirective").directive("postGallery",["trace","$timeout",function(a,b){return{restrict:"EA",templateUrl:"../views/post-gallery.html",link:function(a,c){var d={imgContainer:c.find(".slider-photos"),images:[],currentIndex:0,containerWidth:c.find(".slider-container").width()};d.init=function(){TweenLite.to(c.find(".slider-photos"),.5,{opacity:"1"}),d.images=c.find(".slider-photos img"),d.positionImages(),d.addEventListeners()},d.addEventListeners=function(){$(c).on("click","a",function(a){d.clickHandler(a)})},d.positionImages=function(){for(var a=d.images,b=d.containerWidth,c=0;c<a.length;c++){var e=c*b;$(a[c]).css("width",b+"px").css("left",e+"px").css("top","0px"),$(".slider-photos").css("width",e+b+"px")}},d.setCurrentIndex=function(a){d.currentIndex=a,d.currentIndex>d.images.length-1?d.currentIndex=0:d.currentIndex<0&&(d.currentIndex=d.images.length-1)},d.clickHandler=function(a){switch($(a.currentTarget).attr("class")){case"slider-nav prev":d.setCurrentIndex(d.currentIndex-1);break;case"slider-nav next":d.setCurrentIndex(d.currentIndex+1)}d.updateView()},d.updateView=function(){var a=d.currentIndex-1,b=d.currentIndex+1;0>a&&(a=d.images.length-1),b>d.images.length-1&&(b=0);var c=new TimelineMax({align:"start"});c.add([TweenLite.to(d.images[a],.5,{left:"-"+d.containerWidth+"px",opacity:"0"}),TweenLite.to(d.images[d.currentIndex],.5,{left:"0px",opacity:"1"}),TweenLite.to(d.images[b],.5,{left:d.containerWidth+"px",opacity:"0"})],0),d.images.map(function(a){a===d.currentIndex?$(d.images[a]).css("z-index",1):$(d.images[a]).css("z-index",0)}),$(".currentPanel").html(d.currentIndex)},b(function(){d.init(),d.setCurrentIndex(1),d.updateView()},1e3)}}}]),angular.module("MainDirective").directive("contactForm",["trace","$http","ServerUrl","$q",function(){return{restrict:"EA",templateUrl:"../views/contact-form.html",link:function(){}}}]),angular.module("MainDirective").directive("homeSlider",["trace","$timeout",function(a,b){return{restrict:"EA",link:function(c,d){b(function(){},200),d.bind("click",function(){a("hello world")})}}}]),angular.module("MainDirective").directive("postform",function(){return{restrict:"EA",templateUrl:"../views/post-form.html",link:function(){}}}),angular.module("MainDirective").directive("prettyprint",function(){return{restrict:"C",link:function(a,b){b.html(prettyPrintOne())}}}),angular.module("MainDirective").directive("categoryform",function(){return{restrict:"EA",templateUrl:"../views/category-form.html",link:function(){}}}),angular.module("jwwebApp").factory("trace",function(){return function(){for(var a=0;a<arguments.length;a++)console.log(arguments[a])}}),angular.module("jwwebApp").service("anchorSmoothScroll",["$document","$window",function(a,b){function c(a,b){return a.pageYOffset?a.pageYOffset:b.documentElement&&b.documentElement.scrollTop?b.documentElement.scrollTop:b.body.scrollTop?b.body.scrollTop:0}function d(a,b){for(var c=b.offsetTop,d=b;d.offsetParent&&d.offsetParent!==a.body;)d=d.offsetParent,c+=d.offsetTop;return c}var e=a[0],f=b;this.scrollDown=function(a,b,c,d){for(var e=0,f=Math.round(d/25),g=a+f,h=a;b>h;h+=f)setTimeout("window.scrollTo(0, "+g+")",e*c),g+=f,g>b&&(g=b),e++},this.scrollUp=function(a,b,c,d){for(var e=0,f=Math.round(d/25),g=a-f,h=a;h>b;h-=f)setTimeout("window.scrollTo(0, "+g+")",e*c),g-=f,b>g&&(g=b),e++},this.scrollToTop=function(a){scrollTo(0,a)},this.scrollTo=function(a,b){var g=e.getElementById(a);if(g){var h=c(f,e),i=d(e,g),j=i>h?i-h:h-i;if(100>j)this.scrollToTop(i);else{var k=Math.round(j/100);b=b||(k>20?20:k),i>h?this.scrollDown(h,i,b,j):this.scrollUp(h,i,b,j)}}}}]),angular.module("jwwebApp").factory("AuthFactory",["$http","$window","ServerUrl","trace",function(a,b,c,d){var e=function(b){return d(b),a.post(c+"login",b).success(function(a){j(a)})},f=function(){return a.get(c+"logout").success(function(a){b.sessionStorage.removeItem("jw-token"),d(a)})},g=function(){return!!b.sessionStorage.getItem("jw-token")},h=function(){return d(b.sessionStorage),!!b.sessionStorage.clear()},i=function(b){return a.post(c+"users",{user:b}).success(function(a){j(a)}).error(function(a,b,c,e){d(a,b,c,e,"you are so stupid, you are doing it wrong")})},j=function(c){$.each(c,function(a,c){b.sessionStorage.setItem("jw-"+a,c)}),a.defaults.headers.common.Authorization="Token token="+b.sessionStorage.getItem("jw-token")};return{login:e,logout:f,isAuthenticated:g,clearStorage:h,postNewUser:i}}]),angular.module("jwwebApp").factory("PostsFactory",["$http","ServerUrl","trace",function(a,b,c){var d=[],e=function(){a.get(b+"posts").success(function(a){angular.copy(a,d)}).error(function(a,b,d,e){c(a,b,d,e)})};return{fetch:e,posts:d}}]),angular.module("jwwebApp").factory("CategoryFactory",["$http","ServerUrl","trace",function(a,b,c){var d=[],e=function(){a.get(b+"categories").success(function(a){angular.copy(a,d)}).error(function(a,b,d,e){c(a,b,d,e)})};return{categories:d,fetch:e}}]),angular.module("jwwebApp").factory("AWSFactory",["$http","$q","$location","ServerUrl","AmazonBucket","trace",function(a,b,c,d,e,f){var g,h,i=function(){return b(function(b){a.get(d+"amazon/sign_key").success(function(a){b(a)}).error(function(a,b,c,d){f(a,b,c,d,"failed to get a signkey from api")})})},j=function(b,c){return h=c,i().then(function(d){return g=d,h?void l(k(h),c).then(function(){return a.post(e,m(b),{transformRequest:angular.identity,headers:{"Content-Type":void 0,Authorization:""}}).then(function(a){return a})}):a.post(e,m(b),{transformRequest:angular.identity,headers:{"Content-Type":void 0,Authorization:""}}).then(function(a){return a})})},k=function(a){var b={image:{post_id:a,url:e+g.key}};return b},l=function(c,e){return b(function(b,f){a.post(d+"posts/"+e+"/images",c).success(function(a){b(a)}).error(function(a){f(a)})})},m=function(a){var b=new FormData;return b.append("key",g.key),b.append("AWSAccessKeyId",g.access_key),b.append("policy",g.policy),b.append("acl","public-read"),b.append("signature",g.signature),b.append("Content-Type","image/jpeg"),b.append("file",a),b};return{sendToAmazon:j}}]),angular.module("jwwebApp").filter("truncate",["trace",function(a){return function(b){return a(),b.slice(0,150)+"..."}}]),angular.module("jwwebApp").filter("postsFilter",["trace",function(){return function(a,b){var c=new Array;if(!b)return a;for(var d in a)a[d].categories.length>0&&$(a[d].categories).each(function(e,f){f.name==b&&c.push(a[d])});return c}}]),angular.module("MainController").controller("AboutController",["$scope","trace",function(a,b){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],a.stupidThings=["FormData .append()","rain","another stupid shitty thing","clouds"],b()}]),angular.module("MainController").controller("HomeController",["$scope","$location","$anchorScroll","anchorSmoothScroll","PostsFactory","trace",function(a,b,c,d,e,f){a.posts=e.posts,a.hasImage=function(a){return a.images.length>0},a.scrollDown=function(a){c.yOffset=50,b.hash(a),d.scrollTo(a)},f(a.posts)}]),angular.module("MainController").controller("PostViewController",["$scope","$sce","$q","$http","$route","$routeParams","$location","AuthFactory","AWSFactory","CategoryFactory","ServerUrl","trace",function(a,b,c,d,e,f,g,h,i,j,k,l){a.categories=j.categories,a.post={},d.get(k+"posts/"+f.postId.toString()).success(function(b){c.all(m(b),n()).then(function(){a.post=b,l("done getting post")})}).error(function(a,b,c,d){l(a,b,c,d,"you are so stupid")});var m=function(b){a.post=b},n=function(){_.forEach(a.categories,function(b){a.hasCategory(b)&&(b.checked=!0)})},o=function(b){var c=[];return _.forEach(a.categories,function(e){var f=e.checked,g="undefined"!=typeof _.find(a.post.categories,{id:e.id});f&&!g&&c.push(d.put(k+"posts/"+b+"/categories/"+e.id)),!f&&g&&c.push(d.delete(k+"posts/"+b+"/categories/"+e.id))}),c},p=function(a){for(var b=[],c=$('#imageUpload > input[type="file"]'),d=0,e=c.length;e>d;d++){var f=c[d].files[0];f&&b.push(i.sendToAmazon(f,a))}return b};a.upsertPost=function(b){$(".preloader").addClass("submitted"),$('button[type="submit"]').attr("disabled",!0);var e={post:b};b.id&&d.put(k+"posts/"+b.id,e).success(function(b){c.all(p(b.id),o(b.id)).then(function(){}).finally(function(){$('button[type="submit"]').attr("disabled",!1),$(".preloader").removeClass("submitted"),a.message="Good job motherfucker, you edited your blog post."})})},a.hasCategory=function(b){var c=[];return"undefined"!=typeof a.post&&"undefined"!=typeof a.post.categories&&(c=a.post.categories.filter(function(a){return a.id===b.id})),c.length>0},a.isLoggedIn=function(){return h.isAuthenticated()},a.deletePost=function(a){d.delete(k+"posts/"+a.id).success(function(){g.path("/")})}}]),angular.module("MainController").controller("NewPostController",["$scope","$q","$http","$location","AuthFactory","AmazonBucket","AWSFactory","CategoryFactory","ServerUrl","trace",function(a,b,c,d,e,f,g,h,i,j){a.categories=h.categories;var k=function(b){var d=[];return _.forEach(a.categories,function(a){var e=a.checked;e&&d.push(c.put(i+"posts/"+b+"/categories/"+a.id))}),d},l=function(a){for(var b=[],c=$('#imageUpload > input[type="file"]'),d=0,e=c.length;e>d;d++){var f=c[d].files[0];f&&b.push(g.sendToAmazon(f,a))}return b};a.upsertPost=function(a){$(".preloader").addClass("submitted"),$('button[type="submit"]').attr("disabled",!0);var e={post:a};c.post(i+"posts",e).success(function(a){var c=a;b.all(l(a.id),k(a.id)).finally(function(){$(".preloader").removeClass("submitted"),$('button[type="submit"]').attr("disabled",!1),d.path("/posts/"+c.id)})})},a.upsertCategory=function(a){var b={category:a};c.post(i+"categories",b).success(function(){h.fetch(),$('form[name="categoryForm"]').each(function(){this.reset()})}).error()},a.isLoggedIn=function(){return e.isAuthenticated()},j()}]),angular.module("MainController").controller("NavbarController",["$scope","$http","$window","$location","ServerUrl","AuthFactory","trace",function(a,b,c,d,e,f,g){a.accounts=[{method:"Email",url:"mailto:fishermanswharff@mac.com"},{method:"Github",url:"https://github.com/fishermanswharff"},{method:"Twitter",url:"https://twitter.com/jasonwharff"},{method:"LinkedIn",url:"https://www.linkedin.com/in/jasonwharff"},{method:"Instagram",url:"http://instagram.com/jasonwharff"},{method:"Tumblr",url:"http://blog.jasonwharff.com"}],a.isActive=function(a){return a===d.path()},a.logout=function(){f.logout().success(function(){d.path("/login"),f.clearStorage()})},a.user=function(){return f.getUserData()},a.isLoggedIn=function(){return f.isAuthenticated()},g()}]),angular.module("MainController").controller("FooterController",["$scope",function(a){a.accounts=[{method:"Email",url:"mailto:fishermanswharff@mac.com"},{method:"Github",url:"https://github.com/fishermanswharff"},{method:"Twitter",url:"https://twitter.com/jasonwharff"},{method:"LinkedIn",url:"https://www.linkedin.com/in/jasonwharff"},{method:"Instagram",url:"http://instagram.com/jasonwharff"},{method:"Tumblr",url:"http://blog.jasonwharff.com"}]}]),angular.module("MainController").controller("LoginController",["$scope","$http","$location","AuthFactory","trace",function(a,b,c,d,e){a.createUser=!1,a.message="",a.login=function(a){d.login(a).success(function(a){c.path("/"),e(a)})},a.newUser=function(){a.createUser=!0},a.upsertUser=function(b){d.postNewUser(b).success(function(b){c.path("/login"),a.message="Congratulations, you successfully created an account. Please login to continue.",e(b)})}}]),angular.module("MainController").controller("ContactFormController",["$scope","$http","ServerUrl","trace",function(a,b,c){a.submitContact=function(d){$(".preloader").addClass("submitted"),$("#contact-submit-button").attr("disabled",!0),b.post(c+"email/admin",{name:d.name,email:d.email,body:d.body}).success(function(){a.message={},a.success="Your email was sent successfully.",$("#contact-submit-button").attr("disabled",!1),$(".preloader").removeClass("submitted")}).error(function(){})}}]),angular.module("MainController").controller("ImageUploader",["$scope","$http","AWSFactory","AuthFactory","trace",function(a,b,c,d){a.upsertImage=function(){$(".preloader").addClass("submitted");for(var a=$('#imageUpload > input[type="file"]'),b=0,d=a.length;d>b;b++){var e=a[b].files[0];e&&c.sendToAmazon(e).then(function(){$(".preloader").removeClass("submitted"),$("form#imageUpload").each(function(){this.reset()})})}},a.isLoggedIn=function(){return d.isAuthenticated()}}]);